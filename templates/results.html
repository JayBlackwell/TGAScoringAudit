{% extends "base.html" %}

{% block title %}Analysis Results - TGA Scoring Audit{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <!-- Step Indicator -->
        <div class="step-indicator text-center">
            <span class="step completed">1</span>
            <span class="step completed">2</span>
            <span class="step completed">3</span>
            <span class="step completed">4</span>
            <span class="step completed">5</span>
        </div>

        <!-- Results Summary -->
        <div class="card mb-4">
            <div class="card-header bg-orange text-white">
                <h5 class="mb-0">
                    <i class="bi bi-check-circle"></i> Step 5: Analysis Complete
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-8">
                        <h6>Analysis Summary</h6>
                        <ul class="list-unstyled mb-0">
                            <li><i class="bi bi-calendar2-range text-primary"></i> <strong>Season:</strong> {{ session.season_name }}</li>
                            <li><i class="bi bi-calendar2-date text-primary"></i> <strong>Date Range:</strong> {{ session.start_date }} to {{ session.end_date }}</li>
                            <li><i class="bi bi-flag text-warning"></i> <strong>Flagged Rounds:</strong> {{ results|length }}</li>
                        </ul>
                    </div>
                    <div class="col-md-4 text-end">
                        {% if results %}
                        <a href="{{ url_for('download_csv') }}" class="btn btn-outline-success">
                            <i class="bi bi-download"></i> Download CSV
                        </a>
                        {% endif %}
                        <a href="{{ url_for('clear_session') }}" class="btn btn-outline-secondary ms-2">
                            <i class="bi bi-arrow-clockwise"></i> New Analysis
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Results -->
        {% if results %}
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="bi bi-exclamation-triangle text-warning"></i> Flagged Rounds ({{ results|length }})
                </h5>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-striped table-hover mb-0">
                        <thead class="table-dark">
                            <tr>
                                <th>Event ID</th>
                                <th>Round ID</th>
                                <th>Date</th>
                                <th>Round Name</th>
                                <th>Issue</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for result in results %}
                            <tr>
                                <td>
                                    <code>{{ result.event_id }}</code>
                                </td>
                                <td>
                                    <code>{{ result.round_id }}</code>
                                </td>
                                <td>
                                    <span class="text-nowrap">{{ result.date }}</span>
                                </td>
                                <td>
                                    <strong>{{ result.name }}</strong>
                                </td>
                                <td>
                                    <span class="badge bg-warning text-dark">
                                        {{ result.reason }}
                                    </span>
                                </td>
                                <td>
                                    <a href="{{ result.scorecard_url }}" target="_blank" class="btn btn-sm btn-outline-orange">
                                        <i class="bi bi-box-arrow-up-right"></i> View Scorecard
                                    </a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="card-footer text-muted">
                <div class="row">
                    <div class="col-md-6">
                        <small>
                            <i class="bi bi-info-circle"></i>
                            These rounds require manual review for scoring completeness.
                        </small>
                    </div>
                    <div class="col-md-6 text-end">
                        <small>
                            Click "View Scorecard" to review individual rounds in Golf Genius.
                        </small>
                    </div>
                </div>
            </div>
        </div>
        {% else %}
        <!-- No Issues Found -->
        <div class="card">
            <div class="card-body text-center py-5">
                <div class="text-success mb-3">
                    <i class="bi bi-check-circle" style="font-size: 3rem;"></i>
                </div>
                <h4 class="text-success">No Scoring Issues Found!</h4>
                <p class="text-muted lead">
                    All rounds in the specified date range appear to have complete scoring data.
                </p>
                <p class="text-muted">
                    Your golf leagues are in good shape for the analyzed period.
                </p>
                
                <div class="mt-4">
                    <a href="{{ url_for('clear_session') }}" class="btn btn-orange">
                        <i class="bi bi-arrow-clockwise"></i> Run Another Analysis
                    </a>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Issue Types Reference -->
        <div class="card mt-4">
            <div class="card-header">
                <h6 class="mb-0">
                    <i class="bi bi-question-circle"></i> Understanding the Issues
                </h6>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6>Common Issue Types:</h6>
                        <ul class="list-unstyled">
                            <li><span class="badge bg-warning text-dark me-2">Incomplete front 9</span> Missing scores for holes 1-9</li>
                            <li><span class="badge bg-warning text-dark me-2">Incomplete back 9</span> Missing scores for holes 10-18</li>
                            <li><span class="badge bg-warning text-dark me-2">No scoring data</span> No scores found for any holes</li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h6>Next Steps:</h6>
                        <ol>
                            <li>Click "View Scorecard" to review the round in Golf Genius</li>
                            <li>Check if scores need to be entered or updated</li>
                            <li>Contact players if score entry is incomplete</li>
                            <li>Re-run analysis after corrections are made</li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}